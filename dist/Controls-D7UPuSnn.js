"use strict";var y=Object.defineProperty;var m=i=>{throw TypeError(i)};var p=(i,e,t)=>e in i?y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>p(i,typeof e!="symbol"?e+"":e,t),v=(i,e,t)=>e.has(i)||m("Cannot "+t);var u=(i,e,t)=>e.has(i)?m("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t);var a=(i,e,t)=>(v(i,e,"access private method"),t);const M=require("./CommandClick-BEqO6Fem.js"),c=require("./Core/Commands.cjs.js");require("./Time-DqDcjPhP.js");require("uuid");const h=require("./Vector2-3guUrHSy.js");var s,r,l,f,C,k,w,x,g;class T{constructor(e=!1){u(this,s);d(this,"stack",[]);d(this,"commands",[]);d(this,"onceCommandsExecuted",[]);d(this,"pointerLock",null);d(this,"mouse",new h.Vector2);d(this,"touchStart",new h.Vector2);d(this,"touch",new h.Vector2);window.addEventListener("keyup",a(this,s,C).bind(this)),window.addEventListener("keydown",a(this,s,k).bind(this)),window.addEventListener("mousemove",a(this,s,l).bind(this)),window.addEventListener("click",a(this,s,r).bind(this)),window.addEventListener("touchstart",a(this,s,w).bind(this)),window.addEventListener("touchmove",a(this,s,f).bind(this)),window.addEventListener("touchend",a(this,s,x).bind(this)),e&&(document.onpointerlockchange=()=>{this.pointerLock=document.pointerLockElement},document.body.addEventListener("click",async t=>{t.stopPropagation(),t.which!==3&&await document.body.requestPointerLock({unadjustedMovement:!0})}))}registerCommand(e){return this.commands.some(t=>t.key===e.key)&&console.warn(`Command conflict detected on key : ${e.key}`),this.commands.push(e),e}unregisterCommand(e){let t=this.commands.findIndex(o=>o===e);t>-1&&this.commands.splice(t,1)}update(e){this.commands.filter(o=>o instanceof c.CommandHold&&this.stack.includes(o.key)).forEach(o=>{o.execute(e)})}}s=new WeakSet,r=function(e){e.preventDefault(),this.commands.filter(o=>o instanceof M.CommandClick).forEach(o=>{o.execute({mouse:this.mouse})})},l=function(e){this.mouse.x=e.clientX,this.mouse.y=e.clientY,this.pointerLock&&this.commands.filter(o=>o instanceof c.CommandMouseMove).forEach(o=>{o.execute(e)})},f=function(e){this.touch.x=e.changedTouches[0].screenX,this.touch.y=e.changedTouches[0].screenY,this.commands.filter(o=>o instanceof c.CommandTouchMaintain).forEach(o=>o.execute({touchStart:this.touchStart,touch:this.touch}))},C=function(e){if(this.stack.includes(e.code)){let n=this.stack.findIndex(E=>E===e.code);n>-1&&this.stack.splice(n,1)}this.commands.filter(n=>n instanceof c.CommandToggle&&e.code===n.key&&n.executed).forEach(n=>{n.executed=!1,n.release()}),this.commands.filter(n=>n instanceof c.CommandOnce&&e.code===n.key&&n.executed).forEach(n=>{n.executed=!1})},k=function(e){this.stack.includes(e.code)||this.stack.push(e.code),this.commands.filter(n=>n instanceof c.CommandToggle&&e.code===n.key&&!n.executed).forEach(n=>{n.executed=!0,n.execute()}),this.commands.filter(n=>n instanceof c.CommandOnce&&e.code===n.key&&!n.executed).forEach(n=>{n.executed=!0,n.execute()})},w=function(e){this.touchStart.x=e.changedTouches[0].screenX,this.touchStart.y=e.changedTouches[0].screenY,this.commands.filter(o=>o instanceof c.CommandTouchMaintain).forEach(o=>o.started=!0)},x=function(e){this.commands.filter(o=>o instanceof c.CommandTouchMaintain).forEach(o=>{o.release(),o.started=!1}),this.touchStart.x!==e.changedTouches[0].screenX&&this.touchStart.y!==e.changedTouches[0].screenY&&a(this,s,g).call(this)},g=function(){this.commands.filter(t=>t instanceof c.CommandSwipe).forEach(t=>{t.execute({touch:this.touch,touchStart:this.touchStart})})};exports.Controls=T;
