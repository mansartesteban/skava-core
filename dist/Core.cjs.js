"use strict";var x=Object.defineProperty;var w=s=>{throw TypeError(s)};var C=(s,e,t)=>e in s?x(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var i=(s,e,t)=>C(s,typeof e!="symbol"?e+"":e,t),v=(s,e,t)=>e.has(s)||w("Cannot "+t);var p=(s,e,t)=>(v(s,e,"read from private field"),t?t.call(s):e.get(s)),u=(s,e,t)=>e.has(s)?w("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),m=(s,e,t,r)=>(v(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("./Entity-DtzWs4r1.js");require("./Time-DqDcjPhP.js");const N=require("./Utils.cjs.js");require("uuid");const n=require("./Vector2-3guUrHSy.js"),I=require("./ImplementError-SbvtDx-1.js"),V=require("./UndefinedError-kRLnShLG.js"),j=require("./Controls-D7UPuSnn.js");class f{static start(){return this.engine=new g,new Promise(e=>{e(!0)})}static loadProject(e){this.activeProject=new e,this.engine.setProject(this.activeProject)}}i(f,"activeProject"),i(f,"engine");class M{constructor(){i(this,"options")}refresh(){}render(){throw new I.ImplementError("render","Viewer")}}class b{constructor(e,t){i(this,"options");i(this,"node");i(this,"renderer");i(this,"size",new n.Vector2);i(this,"origin",new n.Vector2);this.node=e,this.options={...this.options,...t},this.renderer=new T(this.options),this.size=this.options.size,this.render()}get ctx(){return this.renderer.ctx}center(){this.origin=this.size.clone().divide(2),this.ctx.translate(this.origin.x,this.origin.y)}render(){this.ctx.clearRect(0,0,this.size.x,this.size.y),this.node.appendChild(this.renderer.domElement)}refresh(){this.ctx.clearRect(-this.size.x/2,-this.size.y/2,this.size.x,this.size.y)}}var h;class S{constructor(e,t){u(this,h,null);i(this,"cameras",{});this.renderer=t,this.scene=e}get activeCamera(){return this.cameras[p(this,h)]}activateCamera(e){m(this,h,e)}addCamera(e,t){this.cameras[e]=t}}h=new WeakMap;const z={INITIALIZED:"INITIALIZED"};class P{constructor(e){i(this,"scenes",[]);i(this,"options",{name:"Skava - Snake",mountOn:"#app",isDev:!1});i(this,"loopCallback");i(this,"observer");this.options={...this.options,...e},this.observer=new a.Observer(Object.keys(z)),setTimeout(this.setup.bind(this),0)}addScene(e,t){e.createViewer(this.options.mountOn),Promise.resolve(e.setup()).then(()=>{e.setupFinished=!0}),this.scenes.push(e)}getScene(e){return this.scenes.find(t=>t.name===e)}setup(){throw new I.ImplementError("setup","Project")}update(e,t){this.scenes.forEach(r=>r.update(e,t)),this.loop(e,t)}loop(e,t){}}var c;class A{constructor(e){i(this,"setupFinished",!1);i(this,"name","");i(this,"entityManager",null);i(this,"viewer");u(this,c,!1);this.name=e,this.entityManager=new d(this)}createViewer(e,t){let r=document.querySelector(e);this.viewer=new b(r,{size:new n.Vector2(window.innerWidth,window.innerHeight),...t})}add(e,t){this.entityManager.add(e,t)}remove(e){this.entityManager.delete(e)}update(e,t){var r;this.setupFinished&&((r=this.viewer)==null||r.refresh(e),this.loop(e,t),this.entityManager.update(e,t))}setup(){console.warn(`"setup()" method is not implemented on the scene ${this.constructor.name}`)}loop(e,t){p(this,c)||(m(this,c,!0),console.warn(`"loop()" method is not implemented on the scene ${this.constructor.name}`))}}c=new WeakMap;const E={INITIALIZED:"INITIALIZED"};class g{constructor(){i(this,"project");i(this,"observer");i(this,"lastUpdate",0);i(this,"fpsMeter");i(this,"i",0);this.observer=new a.Observer(E),this.observer.$on(E.INITIALIZED,this.loop.bind(this)),this.timer=new N.Timer,this.fpsMeter=document.createElement("div"),this.fpsMeter.classList.add("fps-meter"),this.fpsMeter.setAttribute("last-update","0"),document.body.appendChild(this.fpsMeter)}setProject(e){this.project=e,this.observer.$emit(E.INITIALIZED)}async loop(e=0){let t=(e-parseFloat(this.fpsMeter.getAttribute("last-update")))/1e3,r=(e-this.lastUpdate)/1e3;t>.5&&(this.fpsMeter.innerText=(1/r).toFixed(),this.fpsMeter.setAttribute("last-update",e+"")),this.project&&this.project.update(r,e),this.lastUpdate=e,window.requestAnimationFrame(this.loop.bind(this))}}const o=class o{constructor(e){i(this,"observer",new a.Observer(o.EVENTS));i(this,"entities",[]);i(this,"scene",null);if(!e)throw new V.UndefinedError("scene");this.scene=e}delete(e){let t=this.entities.findIndex(r=>typeof e=="string"?r.uuid===e:e instanceof a.Entity?r===e:!1);if(t!==-1){let r=this.entities[t];this.observer.$emit(o.EVENTS.ENTITY_DELETED,r);for(let l=r.components.length-1;l>=0;l--)r.components.splice(l,1);delete this.entities[t],this.entities.splice(t,1)}}add(e,t=!0){e.scene=this.scene,e.children&&e.children.forEach(r=>this.add(r)),t&&Promise.resolve(e.setup()).then(()=>{e.observer.$emit("SETUP_FINISHED")}),this.entities.push(e),this.observer.$emit(o.EVENTS.ENTITY_ADDED,e)}update(e,t){this.entities.forEach(r=>r.update(e,t))}};i(o,"EVENTS",Object.freeze({ENTITY_ADDED:"ENTITY_ADDED",ENTITY_DELETED:"ENTITY_DELETED"}));let d=o;class T extends D{constructor(t){super();i(this,"options");i(this,"domElement");this.options=t,this.createDomElement()}get ctx(){var t;return(t=this.domElement)==null?void 0:t.getContext("2d")}createDomElement(){this.domElement=document.createElement("canvas"),this.domElement.width=this.options.size.x,this.domElement.height=this.options.size.y}}class D{}exports.Entity=a.Entity;exports.Observer=a.Observer;exports.Component=n.Component;exports.RGB=n.RGB;exports.Rotation=n.Rotation;exports.Vector2=n.Vector2;exports.Controls=j.Controls;exports.Application=f;exports.CameraManager=S;exports.CanvasRenderer=T;exports.Engine=g;exports.EntityManager=d;exports.Project=P;exports.Renderer=D;exports.Scene=A;exports.Viewer=M;exports.Viewer2d=b;
