(function(d,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("uuid")):typeof define=="function"&&define.amd?define(["exports","uuid"],f):(d=typeof globalThis<"u"?globalThis:d||self,f(d["skava-engine"]={},d.uuid))})(this,function(d,f){"use strict";var _s=Object.defineProperty;var is=d=>{throw TypeError(d)};var ti=(d,f,w)=>f in d?_s(d,f,{enumerable:!0,configurable:!0,writable:!0,value:w}):d[f]=w;var r=(d,f,w)=>ti(d,typeof f!="symbol"?f+"":f,w),je=(d,f,w)=>f.has(d)||is("Cannot "+w);var i=(d,f,w)=>(je(d,f,"read from private field"),w?w.call(d):f.get(d)),h=(d,f,w)=>f.has(d)?is("Cannot add the same private member more than once"):f instanceof WeakSet?f.add(d):f.set(d,w),o=(d,f,w,P)=>(je(d,f,"write to private field"),P?P.call(d,w):f.set(d,w),w),O=(d,f,w)=>(je(d,f,"access private method"),w);var ns=(d,f,w,P)=>({set _(xe){o(d,f,xe,w)},get _(){return i(d,f,P)}});var W,D,Z,rt,ht,ne,oe,C,os,rs,hs,as,ls,ds,cs,us,j,N,B,H,lt,K,J,A,Q,k,G,_,$,U,V,dt,ct,ut,pt,re,he,Ee,ps,ft,mt,gt,tt,wt,I,yt,xt,et,Ct,St,bt,Et,zt,st,ae,le,de,ce,Y,Mt,kt,It,M,vt,Tt,Pt,it,Dt,Lt,Ot,Ut,L,ue,pe,fe,Rt,Ft,Wt,jt,Nt,Bt,Ht,At,$t,Vt,Yt,qt,Xt,Zt,Kt,Jt,Qt,Gt,_t,te,ge,ze,we,ye,Me,ee;class w{constructor(t={}){r(this,"observers");r(this,"events",{});this.observers=[],this.events=t}$on(t,e){return typeof t=="string"&&(t=[t]),t.forEach(s=>{this.isValidEvent(s),this.observers.push({event:s,callback:e})}),this}unset(t){return this.observers=this.observers.filter(function(e){if(e!==t)return e}),this}$emit(t,...e){let s=[];return this.observers.filter(n=>n.event===t).forEach(n=>{s.push(Promise.resolve(n.callback(...e)))}),Promise.all(s)}isValidEvent(t){if(this.events&&!Object.keys(this.events).includes(t))throw new Error(`Event '${t}' is not a valid event`)}}const E=class E{static update(){let t=performance.now();E.deltaTime=t-E.lastUpdate,this.lastUpdate=t}static now(){return performance.now()}static delta(t,e){return e=e??E.lastUpdate,Math.abs(e-t)}};r(E,"OneMilisecond",1),r(E,"OneSecond",E.OneMilisecond*1e3),r(E,"OneMinute",E.OneSecond*60),r(E,"OneHour",E.OneMinute*60),r(E,"deltaTime",0),r(E,"lastUpdate",performance.now());let P=E;class xe{constructor(){h(this,W);h(this,D);r(this,"executionStack",[]);o(this,W,performance.now()),o(this,D,i(this,W))}get delta(){return P.delta(i(this,W),performance.now())}reset(){o(this,W,performance.now()),o(this,D,i(this,W))}executeAfter(t,e){this.executionStack.push({delay:e,repeat:!1,callback:t,lastCall:i(this,D)})}executeEach(t,e){this.executionStack.push({delay:t,repeat:!0,callback:e,lastCall:i(this,D)})}watchCallbacks(){let t=[];this.executionStack.forEach((e,s)=>{e.repeat?P.delta(i(this,D),e.lastCall)>=e.delay&&(e.callback(),e.lastCall=i(this,D)):(this.delta>=e.delay&&e.callback(),t.push(s))}),t.forEach((e,s)=>this.executionStack.splice(s,1))}update(){o(this,D,performance.now()),this.watchCallbacks()}}W=new WeakMap,D=new WeakMap;const ke={INITIALIZED:"INITIALIZED"};class Ne{constructor(){r(this,"project");r(this,"observer");r(this,"lastUpdate",0);r(this,"fpsMeter");r(this,"i",0);this.observer=new w(ke),this.observer.$on(ke.INITIALIZED,this.loop.bind(this)),this.timer=new xe,this.fpsMeter=document.createElement("div"),this.fpsMeter.classList.add("fps-meter"),this.fpsMeter.setAttribute("last-update","0"),document.body.appendChild(this.fpsMeter)}setProject(t){this.project=t,this.observer.$emit(ke.INITIALIZED)}async loop(t=0){let e=(t-parseFloat(this.fpsMeter.getAttribute("last-update")))/1e3,s=(t-this.lastUpdate)/1e3;e>.5&&(this.fpsMeter.innerText=(1/s).toFixed(),this.fpsMeter.setAttribute("last-update",t+"")),this.project&&this.project.update(s,t),this.lastUpdate=t,window.requestAnimationFrame(this.loop.bind(this))}}class Ie{static start(){return this.engine=new Ne,new Promise(t=>{t(!0)})}static loadProject(t){this.activeProject=new t,this.engine.setProject(this.activeProject)}}r(Ie,"activeProject"),r(Ie,"engine");const fs={IMPLEMENT:"You must implement '%1' method in classes which extends '%2'."};class S extends Error{constructor(t,e){let s=fs.IMPLEMENT.replace("%1",t).replace("%2",e);super(s),this.name=self.toString()}}class ms{constructor(){r(this,"options")}refresh(){}render(){throw new S("render","Viewer")}}const gs=(a=0,t=4)=>{let e=Math.pow(10,t),s=t<0?a:.01/e+a;return Math.round(s*e)/e},ws=(a=0,t=0,e=0,s=!1)=>s?a>t&&a<e:a>=t&&a<=e,ys=(a=0,t=1)=>Math.floor(Math.random()*(t-a+1))+a,xs=(a=0,t=0,e=0,s=0,n=0)=>s+(n-s)/(e-t)*(a-t),Cs=(a=0,t=0,e=0)=>a<t?t:a>e?e:a,q=(a=0,t=0,e=0)=>Math.min(Math.max(a,t),e),Ss=()=>Math.floor(Math.random()*16777215).toString(16),ve=(a=0)=>a*Math.PI/180,Be=(a=0)=>a*(180/Math.PI),bs=Object.freeze(Object.defineProperty({__proto__:null,clamp:q,degreesToRadians:ve,isBetween:ws,lerp:(a,t,e)=>(e=q(e,0,1),(1-e)*a+e*t),mapRange:xs,minMax:Cs,num:gs,radiansToDegrees:Be,random:ys,randomHexadecimal:Ss},Symbol.toStringTag,{value:"Module"})),z=class z{constructor(t,e){h(this,Z);o(this,Z,e?t:ve(t))}get angle(){return i(this,Z)}setAngle(t,e){o(this,Z,e?t:ve(t))}get toRadians(){return this.angle}get toDegrees(){return Be(this.angle)}add(t){return new z(this.angle+t.angle,!0)}sub(t){return new z(this.angle-t.angle,!0)}invert(){return o(this,Z,-this.angle),this}};Z=new WeakMap,r(z,30,new z(Math.PI/6)),r(z,45,new z(Math.PI/4)),r(z,90,new z(Math.PI/2)),r(z,180,new z(Math.PI)),r(z,360,new z(Math.PI*2));let v=z;const x=class x{constructor(t=0,e=0){h(this,rt,0);h(this,ht,0);o(this,rt,t),o(this,ht,e)}get x(){return i(this,rt)}get y(){return i(this,ht)}get length(){return Math.sqrt(this.squid)}get squid(){return this.x**2+this.y**2}get normalized(){return this.length===0?x.O:this.clone().divide(this.length)}get rotation(){return new v(Math.atan2(this.y,this.x),!0)}set x(t){o(this,rt,t)}set y(t){o(this,ht,t)}add(t){if(t instanceof x)this.x+=t.x,this.y+=t.y;else if(typeof t=="number")this.x+=t,this.y+=t;else throw"Unable to compute a addition on the type '"+typeof t+"'. It should be a number or a Vector2";return this}sub(t){if(t instanceof x)this.x-=t.x,this.y-=t.y;else if(typeof t=="number")this.x-=t,this.y-=t;else throw"Unable to compute a subsraction on the type '"+typeof t+"'. It should be a number or a Vector2";return this}divide(t){if(t instanceof x)this.x/=t.x,this.y/=t.y;else if(typeof t=="number")this.x/=t,this.y/=t;else throw"Unable to compute a division on the type '"+typeof t+"'. It should be a number or a Vector2";return this}multiply(t){if(t instanceof x)this.x*=t.x,this.y*=t.y;else if(typeof t=="number")this.x*=t,this.y*=t;else throw"Unable to compute a multiplication on the type '"+typeof t+"'. It should be a number or a Vector2";return this}clampLength(t){return t===0&&this.copy(x.O),this.copy(this.normalized.multiply(Math.min(this.length,t))),this}normalize(){let t=this.normalized;return this.x=t.x,this.y=t.y,this}lerp(t,e){return e=q(e,0,1),this.x=(1-e)*this.x+e*t.x,this.y=(1-e)*this.y+e*t.y,this}invert(){return this.x=-this.x,this.y=-this.y,this}rotate(t){let e=Math.cos(t.toRadians)*this.x-Math.sin(t.toRadians)*this.y,s=Math.sin(t.toRadians)*this.x+Math.cos(t.toRadians)*this.y;return this.x=e,this.y=s,this}dot(t){if(!(t instanceof x))throw"Unable to compute a dot product on non Vector2 object";return this.x*t.x+this.y*t.y}clone(){return new x(this.x,this.y)}copy(t){return t&&(this.x=t.x,this.y=t.y),this}static from(t){return{to:e=>e.clone().sub(t)}}};rt=new WeakMap,ht=new WeakMap,r(x,"X",new x(1,0)),r(x,"Y",new x(0,1)),r(x,"O",new x(0,0)),r(x,"ONE",new x(1,1));let c=x;class He{}class Ae extends He{constructor(e){super();r(this,"options");r(this,"domElement");this.options=e,this.createDomElement()}get ctx(){var e;return(e=this.domElement)==null?void 0:e.getContext("2d")}createDomElement(){this.domElement=document.createElement("canvas"),this.domElement.width=this.options.size.x,this.domElement.height=this.options.size.y}}class $e{constructor(t,e){r(this,"options");r(this,"node");r(this,"renderer");r(this,"size",new c);r(this,"origin",new c);this.node=t,this.options={...this.options,...e},this.renderer=new Ae(this.options),this.size=this.options.size,this.render()}get ctx(){return this.renderer.ctx}center(){this.origin=this.size.clone().divide(2),this.ctx.translate(this.origin.x,this.origin.y)}render(){this.ctx.clearRect(0,0,this.size.x,this.size.y),this.node.appendChild(this.renderer.domElement)}refresh(){this.ctx.clearRect(-this.size.x/2,-this.size.y/2,this.size.x,this.size.y)}}class Es{constructor(t,e){h(this,ne,null);r(this,"cameras",{});this.renderer=e,this.scene=t}get activeCamera(){return this.cameras[i(this,ne)]}activateCamera(t){o(this,ne,t)}addCamera(t,e){this.cameras[t]=e}}ne=new WeakMap;class ot{constructor(t){r(this,"options",{});r(this,"active",!0);r(this,"entity",null);t&&(this.options={...this.options,...t})}updateComponent(t,e){this.active&&this.loop(t,e)}loop(t,e){}refresh(){}setup(){}}const zs={INITIALIZED:"INITIALIZED"};class Ms{constructor(t){r(this,"scenes",[]);r(this,"options",{name:"Skava - Snake",mountOn:"#app",isDev:!1});r(this,"loopCallback");r(this,"observer");this.options={...this.options,...t},this.observer=new w(Object.keys(zs)),setTimeout(this.setup.bind(this),0)}addScene(t,e){t.createViewer(this.options.mountOn),Promise.resolve(t.setup()).then(()=>{t.setupFinished=!0}),this.scenes.push(t)}getScene(t){return this.scenes.find(e=>e.name===t)}setup(){throw new S("setup","Project")}update(t,e){this.scenes.forEach(s=>s.update(t,e)),this.loop(t,e)}loop(t,e){}}const ks={UNDEFINED:"'%1' could not be undefined."};class Ve extends Error{constructor(t){let e=ks.UNDEFINED.replace("%1",t);super(e),this.name=self.toString()}}class se extends ot{constructor(){super(...arguments);r(this,"position",new c(0,0));r(this,"rotation",new v);r(this,"scale",new c(1,1));r(this,"size",new c(0,0))}update(){}}class Te{constructor(...t){r(this,"uuid",f.v4());r(this,"components",new Map);r(this,"transform",new se);r(this,"scene");r(this,"observer",new w({SETUP_FINISHED:"SETUP_FINISHED"}));t.forEach(e=>this.addComponent(e))}addComponent(t){t.entity=this,t.setup(),this.components.set(t.constructor,t)}removeComponent(t){this.components.delete(t.constructor)}getComponent(t){let e=t instanceof ot?t.constructor:t;return this.components.get(e)}update(t,e){this.loop(t,e),this.components.forEach(s=>{s.updateComponent(t,e)})}loop(t,e){}}const at=class at{constructor(t){r(this,"observer",new w(at.EVENTS));r(this,"entities",[]);r(this,"scene",null);if(!t)throw new Ve("scene");this.scene=t}delete(t){let e=this.entities.findIndex(s=>typeof t=="string"?s.uuid===t:t instanceof Te?s===t:!1);if(e!==-1){let s=this.entities[e];this.observer.$emit(at.EVENTS.ENTITY_DELETED,s);for(let n=s.components.length-1;n>=0;n--)s.components.splice(n,1);delete this.entities[e],this.entities.splice(e,1)}}add(t,e=!0){t.scene=this.scene,t.children&&t.children.forEach(s=>this.add(s)),e&&Promise.resolve(t.setup()).then(()=>{t.observer.$emit("SETUP_FINISHED")}),this.entities.push(t),this.observer.$emit(at.EVENTS.ENTITY_ADDED,t)}update(t,e){this.entities.forEach(s=>s.update(t,e))}};r(at,"EVENTS",Object.freeze({ENTITY_ADDED:"ENTITY_ADDED",ENTITY_DELETED:"ENTITY_DELETED"}));let Ce=at;class Is{constructor(t){r(this,"setupFinished",!1);r(this,"name","");r(this,"entityManager",null);r(this,"viewer");h(this,oe,!1);this.name=t,this.entityManager=new Ce(this)}createViewer(t,e){let s=document.querySelector(t);this.viewer=new $e(s,{size:new c(window.innerWidth,window.innerHeight),...e})}add(t,e){this.entityManager.add(t,e)}remove(t){this.entityManager.delete(t)}update(t,e){var s;this.setupFinished&&((s=this.viewer)==null||s.refresh(t),this.loop(t,e),this.entityManager.update(t,e))}setup(){console.warn(`"setup()" method is not implemented on the scene ${this.constructor.name}`)}loop(t,e){i(this,oe)||(o(this,oe,!0),console.warn(`"loop()" method is not implemented on the scene ${this.constructor.name}`))}}oe=new WeakMap;class R{constructor(){r(this,"key")}execute(){throw new S("execute","Command")}}class Pe extends R{execute(...t){throw new S("execute","CommandClick")}}class Ye extends R{execute(){throw new S("execute","CommandHold")}}class qe extends R{execute(...t){throw new S("execute","CommandMouseMove")}}class De extends R{constructor(){super(...arguments);r(this,"executed",!1)}execute(){throw new S("execute","CommandOnce")}}class Xe extends R{execute(...t){throw new S("execute","CommandSwipe")}}class Le extends R{constructor(){super(...arguments);r(this,"executed",!1)}execute(){throw new S("execute","CommandToggle")}release(){throw new S("release","CommandToggle")}}class Se extends R{constructor(){super(...arguments);r(this,"started",!1)}release(...e){throw new S("release","CommandTouchMaintain")}execute(...e){throw new S("execute","CommandTouchMaintain")}}class Ze{constructor(t=!1){h(this,C);r(this,"stack",[]);r(this,"commands",[]);r(this,"onceCommandsExecuted",[]);r(this,"pointerLock",null);r(this,"mouse",new c);r(this,"touchStart",new c);r(this,"touch",new c);window.addEventListener("keyup",O(this,C,as).bind(this)),window.addEventListener("keydown",O(this,C,ls).bind(this)),window.addEventListener("mousemove",O(this,C,rs).bind(this)),window.addEventListener("click",O(this,C,os).bind(this)),window.addEventListener("touchstart",O(this,C,ds).bind(this)),window.addEventListener("touchmove",O(this,C,hs).bind(this)),window.addEventListener("touchend",O(this,C,cs).bind(this)),t&&(document.onpointerlockchange=()=>{this.pointerLock=document.pointerLockElement},document.body.addEventListener("click",async e=>{e.stopPropagation(),e.which!==3&&await document.body.requestPointerLock({unadjustedMovement:!0})}))}registerCommand(t){return this.commands.some(e=>e.key===t.key)&&console.warn(`Command conflict detected on key : ${t.key}`),this.commands.push(t),t}unregisterCommand(t){let e=this.commands.findIndex(s=>s===t);e>-1&&this.commands.splice(e,1)}update(t){this.commands.filter(s=>s instanceof Ye&&this.stack.includes(s.key)).forEach(s=>{s.execute(t)})}}C=new WeakSet,os=function(t){t.preventDefault(),this.commands.filter(s=>s instanceof Pe).forEach(s=>{s.execute({mouse:this.mouse})})},rs=function(t){this.mouse.x=t.clientX,this.mouse.y=t.clientY,this.pointerLock&&this.commands.filter(s=>s instanceof qe).forEach(s=>{s.execute(t)})},hs=function(t){this.touch.x=t.changedTouches[0].screenX,this.touch.y=t.changedTouches[0].screenY,this.commands.filter(s=>s instanceof Se).forEach(s=>s.execute({touchStart:this.touchStart,touch:this.touch}))},as=function(t){if(this.stack.includes(t.code)){let n=this.stack.findIndex(l=>l===t.code);n>-1&&this.stack.splice(n,1)}this.commands.filter(n=>n instanceof Le&&t.code===n.key&&n.executed).forEach(n=>{n.executed=!1,n.release()}),this.commands.filter(n=>n instanceof De&&t.code===n.key&&n.executed).forEach(n=>{n.executed=!1})},ls=function(t){this.stack.includes(t.code)||this.stack.push(t.code),this.commands.filter(n=>n instanceof Le&&t.code===n.key&&!n.executed).forEach(n=>{n.executed=!0,n.execute()}),this.commands.filter(n=>n instanceof De&&t.code===n.key&&!n.executed).forEach(n=>{n.executed=!0,n.execute()})},ds=function(t){this.touchStart.x=t.changedTouches[0].screenX,this.touchStart.y=t.changedTouches[0].screenY,this.commands.filter(s=>s instanceof Se).forEach(s=>s.started=!0)},cs=function(t){this.commands.filter(s=>s instanceof Se).forEach(s=>{s.release(),s.started=!1}),this.touchStart.x!==t.changedTouches[0].screenX&&this.touchStart.y!==t.changedTouches[0].screenY&&O(this,C,us).call(this)},us=function(){this.commands.filter(e=>e instanceof Xe).forEach(e=>{e.execute({touch:this.touch,touchStart:this.touchStart})})};const m=class m{constructor(t,e,s,n){h(this,j,0);h(this,N,0);h(this,B,0);h(this,H,1);if(typeof t=="number"&&e===void 0&&s===void 0){let l=t;o(this,j,l>>16&255),o(this,N,l>>8&255),o(this,B,l&255),o(this,H,1)}else o(this,j,t??i(this,j)),o(this,N,e??i(this,N)),o(this,B,s??i(this,B)),o(this,H,n??i(this,H))}get r(){return i(this,j)}set r(t){o(this,j,q(t,0,255))}get g(){return i(this,N)}set g(t){o(this,N,q(t,0,255))}get b(){return i(this,B)}set b(t){o(this,B,q(t,0,255))}get opacity(){return i(this,H)}set opacity(t){o(this,H,t)}get rgba(){return[this.r,this.g,this.b,this.opacity]}get _toString(){return"#"+parseInt(this.r.toFixed(0)).toString(16).padStart(2,"0")+parseInt(this.g.toFixed(0)).toString(16).padStart(2,"0")+parseInt(this.b.toFixed(0)).toString(16).padStart(2,"0")+parseInt(Math.floor(this.opacity*255).toFixed(0)).toString(16).padStart(2,"0")}add(t){if(t instanceof m)return new m(this.r+t.r,this.g+t.g,this.b+t.b,this.opacity+t.opacity);if(typeof t=="number")return new m(this.r+t,this.g+t,this.b+t,this.opacity+t);throw"Unable to compute a addition on the type '"+typeof t+"'. It should be a number or a Color"}multiply(t){if(t instanceof m)return new m(Math.floor(this.r*t.r/255),Math.floor(this.g*t.g/255),Math.floor(this.b*t.b/255),Math.floor(this.opacity*t.opacity));if(typeof t=="number")return new m(this.r*t,this.g*t,this.b*t);throw"Unable to compute a multiplication on the type '"+typeof t+"'. It should be a number or a Color"}lerp(t,e,s=!0){return this.r=(1-e)*this.r+e*t.r,this.g=(1-e)*this.g+e*t.g,this.b=(1-e)*this.b+e*t.b,s&&(this.opacity=(1-e)*this.opacity+e*t.opacity),this}clone(){return new m(this.r,this.g,this.b,this.opacity)}copy(t){return t&&(this.r=t.r,this.g=t.g,this.b=t.b,this.opacity=t.opacity),this}};j=new WeakMap,N=new WeakMap,B=new WeakMap,H=new WeakMap,r(m,"Black",new m(0)),r(m,"White",new m(16777215)),r(m,"Grey",new m(8355711)),r(m,"LightGrey",new m(12566463)),r(m,"DarkGrey",new m(4144959)),r(m,"Red",new m(16711680)),r(m,"Green",new m(65280)),r(m,"Blue",new m(255)),r(m,"Yellow",new m(16776960)),r(m,"Cyan",new m(65535)),r(m,"Fuchsia",new m(16711935));let y=m;const vs={IMPLEMENT:"The given parameter is not of type '%1'. %2 given."};class Oe extends Error{constructor(t,e){let s=vs.IMPLEMENT.replace("%1",e.name).replace("%2",t.constructor.name);super(s),this.name=self.toString()}}class Ts extends ot{constructor(t){super(),this.options={updateFrequency:16},t&&(this.options={...this.options,...t})}updateComponent(t,e){this.render(this.entity.scene.viewer,t,e)}render(t,e,s){throw new S("render","RenderComponent")}}const ie={strokeStyle:"#000",lineWidth:"1",fillStyle:"#000"},Ue={setLineDash:[]};class T{static draw(t,e){let s=t.ctx;s.beginPath();let n=e();s.closePath(),n&&T.reset(s,n)}static strokeRect(t,e,s,n,l,p=y.Green){let u=new c(e,s),b=1;t.fillStyle=p._toString||"#ff0000",t.fillRect(u.x,u.y,n,l),t.fillStyle="#000000",t.fillRect(u.x+b,u.y+b,n-b*2,l-b*2)}static reset(t,e=[]){e.length===0&&(e=Object.keys(ie).concat(Object.keys(Ue))),e.forEach(s=>{if(Object.keys(ie).indexOf(s)!==-1)switch(s){case"fillStyle":t.fillStyle=ie.fillStyle;break;case"lineWidth":t.lineWidth=ie.lineWidth;break;case"strokeStyle":t.strokeStyle=ie.strokeStyle;break}else if(Object.keys(Ue).indexOf(s)!==-1)switch(s){case"setLineDash":t.setLineDash(Ue.setLineDash);break}})}}class Ps{constructor(t=new c,e=1,s=new y,n=null,l=null,p={}){h(this,lt);h(this,K);h(this,J);h(this,A);h(this,Q);h(this,k);o(this,lt,t),o(this,K,e),o(this,J,s),this.angle=n,this.direction=l,o(this,k,p)}get position(){return i(this,lt)}get radius(){return i(this,K)}get color(){return i(this,J)}get angle(){return i(this,A)}get direction(){return i(this,Q)}get options(){return i(this,k)}set position(t){o(this,lt,t)}set radius(t){o(this,K,t)}set color(t){o(this,J,t)}set angle(t){t||(t=new v(Math.PI*2,!0)),o(this,A,t)}set direction(t){t||(t=new c),o(this,Q,t)}set options(t){o(this,k,t)}draw(t){let e=t.ctx;T.draw(t,()=>(e.fillStyle=i(this,J)._toString,i(this,k).shadowBlur&&(e.shadowBlur=i(this,k).shadowBlur),i(this,k).shadowColor&&(e.shadowColor=i(this,k).shadowColor._toString),e.arc(this.position.x,this.position.y,i(this,K),i(this,Q).rotation.angle-i(this,A).angle/2,i(this,Q).rotation.angle+i(this,A).angle/2),i(this,A).angle%(2*Math.PI)!==0&&e.lineTo(this.position.x,this.position.y),e.fill(),i(this,k).shadowBlur&&(e.shadowBlur=0),i(this,k).shadowColor&&(e.shadowColor=""),["fillStyle"]))}}lt=new WeakMap,K=new WeakMap,J=new WeakMap,A=new WeakMap,Q=new WeakMap,k=new WeakMap;class Ds{constructor(t=new c,e=1,s=new(i(this,$)),n=new v(Math.PI*2,!0),l=new c){h(this,G);h(this,_);h(this,$);h(this,U);h(this,V);o(this,G,t),o(this,_,e),o(this,$,s),o(this,U,n),o(this,V,l)}get position(){return i(this,G)}get radius(){return i(this,_)}get color(){return i(this,$)}get angle(){return i(this,U)}get direction(){return i(this,V)}set position(t){o(this,G,t)}set radius(t){o(this,_,t)}set color(t){o(this,$,t)}set angle(t){o(this,U,t)}set direction(t){o(this,V,t)}draw(t){let e=t.ctx;T.draw(t,()=>{e.fillStyle=i(this,$)._toString;let s=i(this,G);return e.arc(s.x,s.y,i(this,_),i(this,V).rotation.angle-i(this,U).angle/2,i(this,V).rotation.angle+i(this,U).angle/2),i(this,U).angle%(2*Math.PI)!==0&&e.lineTo(s.x,s.y),e.fill(),["fillStyle"]})}}G=new WeakMap,_=new WeakMap,$=new WeakMap,U=new WeakMap,V=new WeakMap;class Ls{constructor(t=new c,e=new c,s=y.Fuchsia,n=5){h(this,dt);h(this,ct);h(this,ut);h(this,pt);h(this,re,0);o(this,dt,t),o(this,ct,e),o(this,ut,s),o(this,pt,n)}get from(){return i(this,dt)}get to(){return i(this,ct)}set from(t){o(this,dt,t)}set to(t){o(this,ct,t)}draw(t){let e=t.ctx;T.draw(t,()=>{e.strokeStyle=i(this,ut)._toString,e.lineWidth=i(this,pt),e.fillStyle=i(this,ut)._toString;let s=q(i(this,pt)*3,10,1e3);if(c.from(this.from).to(this.to).length<=s){let nt=i(this,re)%4<2?"#ff0000":"#ffffff";e.strokeStyle=nt,e.fillStyle=nt}this.to.add(c.from(this.from).to(this.to).normalized.multiply(-s));let n=this.to.clone().add(c.from(this.from).to(this.to).normalized.multiply(s)),l=c.from(this.to).to(this.from).normalize(),p=s*2,u=l.clone().rotate(new v(Math.PI*2)).multiply(p).add(this.to),b=l.clone().rotate(new v(-Math.PI*2)).multiply(p).add(this.to);return e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y),e.stroke(),e.moveTo(n.x,n.y),e.lineTo(u.x,u.y),e.lineTo(b.x,b.y),e.lineTo(n.x,n.y),e.fill(),["strokeStyle","lineWidth","fillStyle"]}),ns(this,re)._++}}dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,pt=new WeakMap,re=new WeakMap;class Re{constructor(t){h(this,Ee);h(this,he);r(this,"img");r(this,"imgLoaded");o(this,he,t),this.img=new Image,this.imgLoaded=!1,O(this,Ee,ps).call(this)}draw(t,e=new se){let s=t.ctx,n=e.position;e.scale;let l=e.size,p=e.rotation;this.imgLoaded&&(s.save(),s.translate(n.x,n.y),s.rotate(-p.angle),s.translate(-n.x,-n.y),s.shadowOffsetX=3,s.shadowOffsetY=2,s.shadowColor=new y(0,0,0,.25)._toString,s.shadowBlur=4,s.drawImage(this.img,n.x,n.y,l.x,l.y),s.restore())}}he=new WeakMap,Ee=new WeakSet,ps=function(){this.img.onload=()=>{this.imgLoaded=!0},this.img.src=i(this,he)};class Os{constructor(t=new c,e=new c,s=new y,n=1,l=[],p={}){h(this,ft);h(this,mt);h(this,gt);h(this,tt);h(this,wt);h(this,I);o(this,ft,t),o(this,mt,e),o(this,gt,s),o(this,tt,l),o(this,wt,n),o(this,I,p)}get from(){return i(this,ft)}get to(){return i(this,mt)}get color(){return i(this,gt)}get dashes(){return i(this,tt)}get thickness(){return i(this,wt)}get options(){return i(this,I)}set from(t){o(this,ft,t)}set to(t){o(this,mt,t)}set color(t){o(this,gt,t)}set dashes(t){o(this,tt,t)}set thickness(t){o(this,wt,t)}set options(t){o(this,I,t)}draw(t){let e=t.ctx;T.draw(t,()=>{const s=i(this,tt).map(n=>typeof n=="string"?parseInt(n):n);return i(this,I).shadowBlur&&(e.shadowBlur=i(this,I).shadowBlur),i(this,I).shadowColor&&(e.shadowColor=i(this,I).shadowColor._toString),e.lineCap="round",e.setLineDash(s),e.strokeStyle=this.color._toString,e.lineWidth=this.thickness,e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y),e.stroke(),i(this,I).shadowBlur&&(e.shadowBlur=0),i(this,I).shadowColor&&(e.shadowColor=""),["strokeStyle","setLineDash","lineWidth"]})}}ft=new WeakMap,mt=new WeakMap,gt=new WeakMap,tt=new WeakMap,wt=new WeakMap,I=new WeakMap;class Us{constructor(t=[],e=new y,s=1,n=[]){h(this,yt);h(this,xt);h(this,et);h(this,Ct);o(this,yt,t),o(this,xt,e),o(this,et,n),o(this,Ct,s)}get points(){return i(this,yt)}get color(){return i(this,xt)}get dashes(){return i(this,et)}get thickness(){return i(this,Ct)}set points(t){o(this,yt,t)}set color(t){o(this,xt,t)}set dashes(t){o(this,et,t)}set thickness(t){o(this,Ct,t)}draw(t){let e=t.ctx;T.draw(t,()=>{const s=i(this,et).map(n=>typeof n=="string"?parseInt(n):n);e.lineCap="round",e.setLineDash(s),e.strokeStyle=this.color._toString,e.lineWidth=this.thickness;for(let n=0;n<this.points.length-1;n++)e.moveTo(this.points[n].x,this.points[n].y),e.lineTo(this.points[n+1].x,this.points[n+1].y);return e.moveTo(this.points[this.points.length-1].x,this.points[this.points.length-1].y),e.stroke(),["strokeStyle","setLineDash","lineWidth"]})}}yt=new WeakMap,xt=new WeakMap,et=new WeakMap,Ct=new WeakMap;class Rs{constructor(){r(this,"checkpoints",[])}save(){}back(t){}draw(t){t.ctx}}class be{constructor(t=new c,e=new c,s=[0],n=new y,l=new v){h(this,St);h(this,bt);h(this,Et);h(this,zt);h(this,st);h(this,ae);h(this,le);h(this,de);h(this,ce);o(this,St,t),o(this,bt,e),o(this,Et,s),o(this,zt,l),o(this,st,n)}get position(){return i(this,St)}get size(){return i(this,bt)}get radius(){return i(this,Et)}get color(){return i(this,st)}get rotation(){return i(this,zt)}get shadowBlur(){return i(this,ae)}get shadowColor(){return i(this,le)}get shadowSize(){return i(this,de)}get shadowPosition(){return i(this,ce)}set position(t){o(this,St,t)}set size(t){o(this,bt,t)}set radius(t){o(this,Et,t)}set color(t){o(this,st,t)}set rotation(t){o(this,zt,t)}set shadowBlur(t){o(this,ae,t)}set shadowColor(t){o(this,le,t)}set shadowSize(t){o(this,de,t)}set shadowPosition(t){o(this,ce,t)}draw(t){let e=t.ctx;T.draw(t,()=>(e.fillStyle=i(this,st)._toString,e.save(),e.translate(this.position.x+this.size.x/2,this.position.y+this.size.y/2),e.rotate(-this.rotation.angle),e.translate(-this.position.x-this.size.x/2,-this.position.y-this.size.y/2),e.imageSmoothingEnabled=!1,this.shadowBlur&&(e.shadowBlur=this.shadowBlur),this.shadowColor&&(e.shadowColor=this.shadowColor._toString),e.roundRect(this.position.x,this.position.y,this.size.x,this.size.y,this.radius),e.fill(),e.restore(),this.shadowBlur&&(e.shadowBlur=0),this.shadowColor&&(e.shadowColor=""),["fillStyle"]))}}St=new WeakMap,bt=new WeakMap,Et=new WeakMap,zt=new WeakMap,st=new WeakMap,ae=new WeakMap,le=new WeakMap,de=new WeakMap,ce=new WeakMap;class Fs extends Re{constructor(e,s={}){super(e);h(this,Y);h(this,Mt);h(this,kt);h(this,It);r(this,"offsetRotation");h(this,M);o(this,Y,s.columns||1),o(this,Mt,s.rows||1),o(this,kt,i(this,Mt)*i(this,Y)||1),o(this,It,s.scale||1),this.offsetRotation=s.offsetRotation||new v,o(this,M,0)}get current(){return i(this,M)}set current(e){o(this,M,e)}next(e=1){o(this,M,i(this,M)+e),i(this,M)>i(this,kt)-1&&o(this,M,0)}prev(e=1){o(this,M,i(this,M)-e),i(this,M)<0&&o(this,M,i(this,kt)-1)}draw(e,s=new se){let n=e.ctx,l=s.position,p=s.rotation;if(this.imgLoaded){let u=new c(i(this,M)%i(this,Y),Math.floor(i(this,M)/i(this,Y))),b=this.img.width/i(this,Y),nt=this.img.height/i(this,Mt),es=b*i(this,It),ss=nt*i(this,It);n.save(),n.translate(l.x,l.y),n.rotate(-p.sub(this.offsetRotation).angle),n.translate(-l.x,-l.y),n.imageSmoothingEnabled=!1,n.drawImage(this.img,u.x*b,u.y*nt,b,nt,l.x-es/2,l.y-ss/2,es,ss),n.restore()}}}Y=new WeakMap,Mt=new WeakMap,kt=new WeakMap,It=new WeakMap,M=new WeakMap;class Ws{constructor(t,e){r(this,"sprite");r(this,"positions");h(this,vt);this.sprite=t,this.positions=e,o(this,vt,0),this.sprite.current=this.positions[this.current]}get current(){return i(this,vt)}set current(t){o(this,vt,t),this.sprite.current=this.positions[this.current]}next(){this.current++,this.current>=this.positions.length&&(this.current=0)}prev(){this.current--,this.current<0&&(this.current=this.positions.length-1)}draw(t,e){this.sprite.draw(t,e)}}vt=new WeakMap;class js{constructor(t=new c,e=new c,s=new y){h(this,Tt);h(this,Pt);h(this,it);o(this,Tt,t),o(this,Pt,e),o(this,it,s)}get position(){return i(this,Tt)}get size(){return i(this,Pt)}get color(){return i(this,it)}set position(t){o(this,Tt,t)}set size(t){o(this,Pt,t)}set color(t){o(this,it,t)}draw(t){let e=t.ctx;T.draw(t,()=>(e.fillStyle=i(this,it)._toString,e.fillRect(this.position.x,this.position.y,this.size.x,this.size.y),e.fill(),["fillStyle"]))}}Tt=new WeakMap,Pt=new WeakMap,it=new WeakMap;class Ke{constructor(t="",e=new c,s=y.White,n=10){h(this,Dt);h(this,Lt);h(this,Ot);h(this,Ut);o(this,Dt,t),o(this,Lt,e),o(this,Ot,s),o(this,Ut,n)}get text(){return i(this,Dt)}get position(){return i(this,Lt)}get color(){return i(this,Ot)}get fontSize(){return i(this,Ut)}set text(t){o(this,Dt,t)}set position(t){o(this,Lt,t)}set color(t){o(this,Ot,t)}set fontSize(t){o(this,Ut,t)}draw(t){let e=t.ctx;T.draw(t,()=>(e.font=`${this.fontSize}pt BraahOne`,e.textAlign="center",e.textBaseline="center",e.fillStyle=this.color._toString,e.fillText(this.text.toString(),this.position.x,this.position.y+this.fontSize/3),["fillStyle"]))}}Dt=new WeakMap,Lt=new WeakMap,Ot=new WeakMap,Ut=new WeakMap;const Fe=a=>{let t=Object.getPrototypeOf(a),e=Object.getOwnPropertyDescriptors(t);return Object.keys(e).filter(n=>typeof e[n].get=="function").reduce((n,l)=>(n[l]=a[l],n),{})},Ns=Object.freeze(Object.defineProperty({__proto__:null,getProperties:Fe},Symbol.toStringTag,{value:"Module"}));class Je extends ot{}class X{constructor(){r(this,"uiComponent");r(this,"datas")}setup(){}loop(){}render(){throw new S("render","UIRenderer")}}class Qe{constructor(t){h(this,L);h(this,ue);r(this,"indexInParent",0);r(this,"datas",{size:new c,margin:[0,0,0,0]});if(!(t instanceof g))throw new Oe(t,g);this.style=t,this.component=t.entity}get component(){return i(this,L)}get style(){return i(this,ue)}get parent(){return i(this,L).parent||i(this,L).root}get lastSibling(){return this.parent.tree[this.indexInParent-1]}get lastSiblingStyleHandler(){var t,e;return(e=(t=this.lastSibling)==null?void 0:t.getComponent(g))==null?void 0:e.styleHandler}set style(t){o(this,ue,t)}set component(t){o(this,L,t)}autoHeightParent(t,e){let s=t.getComponent(g),n=e.getComponent(g);s.height==="auto"&&(s.styleHandler.datas.size.y=n.styleHandler.getNextFreePosition(t).y,t.transform.size.y=n.styleHandler.getNextFreePosition(t).y),e=t,t=t.parent,t&&t!==i(this,L).root&&s.height==="auto"&&this.autoHeightParent(t,e)}calculateSize(t){let e=0,s=0;if(this.style.width){if(typeof this.style.width=="number")e=this.style.width;else if(typeof this.style.width=="string")if(this.style.width.endsWith("%")){let n=parseFloat(this.style.width.replace("%",""));e=t.size.x*(n/100)}else this.style.width.endsWith("px")?e=parseFloat(this.style.width.replace("px","")):e=this.style.width}if(this.style.height){if(typeof this.style.height=="number")s=this.style.height;else if(typeof this.style.height=="string")if(this.style.height.endsWith("%")){let n=parseFloat(this.style.height.replace("%",""));s=t.size.y*(n/100)}else this.style.height.endsWith("px")?s=parseFloat(this.style.height.replace("px","")):s=this.style.height}if(this.datas.size.x=e,this.datas.size.y=s,this.style.margin){let n=this.style.margin;Array.isArray(n)?n.length===1?n=[n[0],n[0],n[0],n[0]]:n.length===2?n=[n[0],n[1],n[0],n[1]]:n.length===3&&(n=[n[0],n[1],n[1],n[2]]):n=[n,n,n,n],n=n.map((l,p)=>{if(typeof l=="number")return l;if(l.endsWith("%")){let u=parseFloat(l.replace("%",""));return([0,2].includes(p)?t.size.y:t.size.x)*(u/100)}else return l.endsWith("px")?parseFloat(l.replace("px","")):parseFloat(l)}),this.style.direction==="vertical"?e-=n[1]+n[3]:this.style.direction==="horizontal"&&(s-=n[0]+n[2]),this.datas.margin=n}return new c(Math.max(0,e),Math.max(0,s))}getNextFreePosition(t,e){let s=new c;if(t){let n=t.getComponent(g),l=t.tree;e!==void 0&&(l=l.slice(0,e)),l.forEach(p=>{let u=p.getComponent(g).styleHandler.datas;n.direction==="vertical"?(s.y+=u.size.y,s.y+=u.margin[0]+u.margin[2]):(s.x+=p.size.x,s.x+=u.margin[1]+u.margin[3])})}return s}calculatePosition(t){let e=t.position.x+(this.style.direction==="horizontal"&&this.getNextFreePosition(i(this,L).parent,this.indexInParent).x||0),s=t.position.y+(this.style.direction==="vertical"&&this.getNextFreePosition(i(this,L).parent,this.indexInParent).y||0);if(this.style.margin){let l=this.style.margin;Array.isArray(l)?l.length===1?l=[l[0],l[0],l[0],l[0]]:l.length===2?l=[l[0],l[1],l[0],l[1]]:l.length===3&&(l=[l[0],l[1],l[1],l[2]]):l=[l,l,l,l],l=l.map((p,u)=>{if(typeof p=="number")return p;if(p.endsWith("%")){let b=parseFloat(p.replace("%",""));return([0,2].includes(u)?t.size.y:t.size.x)*(b/100)}else return p.endsWith("px")?parseFloat(p.replace("px","")):parseFloat(p)}),e+=l[3],s+=l[0]}let n=this.parent.getComponent(g);return n.align&&n.align==="center"&&(n.direction==="horizontal"?s+=t.size.y/2-this.component.transform.size.y/2-this.datas.margin[0]/2-this.datas.margin[2]/2:e+=t.size.x/2-this.component.transform.size.x/2-this.datas.margin[1]/2-this.datas.margin[3]/2),new c(e,s)}handleStyle(){var e;let t=(e=this.component.parent)==null?void 0:e.transform;(!t||this.style.layout==="absolute")&&(t=this.component.root.transform),this.component.isRoot||(this.component.transform.size=this.calculateSize(t),this.component.transform.position=this.calculatePosition(t)),this.component.parent&&this.component.parent!==this.component.root&&this.autoHeightParent(this.component.parent||this.component.root,this.component)}}L=new WeakMap,ue=new WeakMap;const me=class me extends ot{constructor(e,s=!1){super();h(this,pe,!1);h(this,fe,!1);h(this,Rt);h(this,Ft);h(this,Wt);h(this,jt);h(this,Nt);h(this,Bt);h(this,Ht);h(this,At);h(this,$t);h(this,Vt);h(this,Yt);h(this,qt);h(this,Xt);h(this,Zt);h(this,Kt);h(this,Jt);h(this,Qt);h(this,Gt);h(this,_t);e&&(this.color=e.color||i(this,Rt),this.textColor=e.textColor||i(this,Ft),this.font=e.font||i(this,Wt),this.fontWeight=e.fontWeight||i(this,jt),this.fontSize=e.fontSize||i(this,Nt),this.borderRadius=e.borderRadius||i(this,Bt),this.borderWidth=e.borderWidth||i(this,Ht),this.borderColor=e.borderColor||i(this,At),this.shadowColor=e.shadowColor||i(this,$t),this.shadowBlur=e.shadowBlur||i(this,Vt),this.shadowPosition=e.shadowPosition||i(this,Yt),this.shadowSize=e.shadowSize||i(this,qt),this.layout=e.layout||i(this,Xt),this.margin=e.margin||i(this,Zt),this.padding=e.padding||i(this,Kt),this.width=e.width||i(this,Jt),this.height=e.height||i(this,Qt),this.direction=e.direction||i(this,Gt),this.align=e.align||i(this,_t)),o(this,pe,s)}get color(){return i(this,Rt)}get textColor(){return i(this,Ft)}get font(){return i(this,Wt)}get fontWeight(){return i(this,jt)}get fontSize(){return i(this,Nt)}get borderRadius(){return i(this,Bt)}get borderWidth(){return i(this,Ht)}get borderColor(){return i(this,At)}get shadowColor(){return i(this,$t)}get shadowBlur(){return i(this,Vt)}get shadowPosition(){return i(this,Yt)}get shadowSize(){return i(this,qt)}get layout(){return i(this,Xt)}get margin(){return i(this,Zt)}get padding(){return i(this,Kt)}get width(){return i(this,Jt)}get height(){return i(this,Qt)}get direction(){return i(this,Gt)}get align(){return i(this,_t)}get needsUpdate(){return i(this,fe)}get inherit(){return i(this,pe)}set color(e){o(this,Rt,e),this.needsUpdate=!0}set textColor(e){o(this,Ft,e),this.needsUpdate=!0}set font(e){o(this,Wt,e),this.needsUpdate=!0}set fontWeight(e){o(this,jt,e),this.needsUpdate=!0}set fontSize(e){o(this,Nt,e),this.needsUpdate=!0}set borderRadius(e){o(this,Bt,e),this.needsUpdate=!0}set borderWidth(e){o(this,Ht,e),this.needsUpdate=!0}set borderColor(e){o(this,At,e),this.needsUpdate=!0}set shadowColor(e){o(this,$t,e),this.needsUpdate=!0}set shadowBlur(e){o(this,Vt,e),this.needsUpdate=!0}set shadowPosition(e){o(this,Yt,e),this.needsUpdate=!0}set shadowSize(e){o(this,qt,e),this.needsUpdate=!0}set layout(e){o(this,Xt,e),this.needsUpdate=!0}set margin(e){o(this,Zt,e),this.needsUpdate=!0}set padding(e){o(this,Kt,e),this.needsUpdate=!0}set width(e){o(this,Jt,e),this.needsUpdate=!0}set height(e){o(this,Qt,e),this.needsUpdate=!0}set direction(e){o(this,Gt,e),this.needsUpdate=!0}set needsUpdate(e){o(this,fe,e)}set align(e){o(this,_t,e)}setup(){this.styleHandler=new Qe(this)}loop(){this.styleHandler.handleStyle()}setDefaultStyle(e){let s=this.entity.getComponent(me);Object.keys(Fe(e)).forEach(n=>{n!=="inherit"&&s[n]===void 0&&(s[n]=e[n])})}setStyle(e,s=!0,n=!1){let l=this.entity.getComponent(me),p=e;e instanceof me&&(p=Fe(e)),Object.keys(p).forEach(u=>{u!=="inherit"&&(s?p[u]!==void 0&&(l[u]=p[u]||l[u]):n?l[u]===void 0&&(l[u]=p[u]):l[u]=l[u]||p[u])})}};pe=new WeakMap,fe=new WeakMap,Rt=new WeakMap,Ft=new WeakMap,Wt=new WeakMap,jt=new WeakMap,Nt=new WeakMap,Bt=new WeakMap,Ht=new WeakMap,At=new WeakMap,$t=new WeakMap,Vt=new WeakMap,Yt=new WeakMap,qt=new WeakMap,Xt=new WeakMap,Zt=new WeakMap,Kt=new WeakMap,Jt=new WeakMap,Qt=new WeakMap,Gt=new WeakMap,_t=new WeakMap;let g=me;class F extends Te{constructor(...e){super(...e);h(this,te);h(this,ge);h(this,ze,[]);h(this,we);h(this,ye,[]);h(this,Me,[]);r(this,"setupDone",!1);r(this,"reactToEvents",!0);r(this,"uiManager");r(this,"datas",{origin:new c,defaultSlot:null});r(this,"slots",new Map);r(this,"eventObserver",new w({click:"click"}));r(this,"transform",new se);e.find(n=>n instanceof g)||this.addComponent(new g)}get parent(){return i(this,ge)}get children(){return i(this,ze)}get root(){return i(this,we)}get isRoot(){return this.root===this}get tree(){return i(this,ye)}get pendingTree(){return i(this,Me)}set parent(e){o(this,ge,e)}set root(e){o(this,we,e)}set tree(e){this.tree=e}setup(){this.setupDone=!0,this.setDefaultSlot(this)}addRenderer(e){if(!(e instanceof X))throw new Oe(e,X);return e.uiComponent=this,e.setup(),o(this,te,e),this}setStyle(e){this.getComponent(g).setStyle(e)}setSlot(e,s){this.slots.set(e,s)}setDefaultSlot(e){this.setSlot("default",e)}addChild(e,s="default"){e.parent=this,e.uiManager=this.uiManager,e.getComponent(g).styleHandler.indexInParent=i(this,ye).length;let n=this.slots.get(s)||this;return this.setupDone?n.tree.push(e):n.pendingTree.push({slot:s,component:e}),this}addEventListener(e,s){this.eventObserver.$on(e,s)}trigger(e,...s){this.eventObserver.$emit(e,...s)}loop(e,s){var n,l;(n=i(this,te))==null||n.loop(),(l=i(this,te))==null||l.render(this.scene.viewer,e,s)}}te=new WeakMap,ge=new WeakMap,ze=new WeakMap,we=new WeakMap,ye=new WeakMap,Me=new WeakMap;class Ge extends Pe{constructor(t){super(),this.elements=t}execute({mouse:t}){t=t.clone();let e=this.elements.find(s=>s.transform.position.x+s.scene.viewer.origin.x<=t.x&&s.transform.position.x+s.scene.viewer.origin.x+s.transform.size.x>=t.x&&s.transform.position.y+s.scene.viewer.origin.y<=t.y&&s.transform.position.y+s.scene.viewer.origin.y+s.transform.size.y>=t.y&&s.reactToEvents);e&&e.trigger("click",{mouse:t,element:e})}}class _e extends F{constructor(){super(...arguments);r(this,"toProcess",[])}setup(){this.root=this,super.setup(),this.copyViewerTransform()}addChild(e){for(e.root=this.root,e.scene=this.scene,e.getComponent(g).setDefaultStyle(this.getComponent(g)),this.scene.add(e),this.uiManager.add(e);e.pendingTree.length>0;){let s=e.pendingTree.shift(),n=e.slots.get(s.slot)||e;s.component.parent=n,s.component.getComponent(g).styleHandler.indexInParent=n.tree.length,n.tree.push(s.component)}return e.tree.forEach(s=>this.addChild(s)),this}copyViewerTransform(){this.transform.position.x=-this.scene.viewer.origin.x,this.transform.position.y=-this.scene.viewer.origin.y,this.transform.size.x=this.scene.viewer.size.x,this.transform.size.y=this.scene.viewer.size.y}loop(){this.copyViewerTransform(),super.loop()}}class Bs{constructor(t){h(this,ee,[]);r(this,"controls");r(this,"scene");r(this,"mainLayout");this.controls=new Ze,this.controls.registerCommand(new Ge(i(this,ee))),this.scene=t,this.mainLayout=new _e(new g({borderRadius:0,margin:0,padding:0,fontSize:24,width:"100%",height:"auto",align:"left",layout:"relative",color:y.White,textColor:y.Black,fontWeight:500,borderWidth:1,borderColor:y.Black,shadowColor:null,shadowBlur:null,shadowPosition:null,shadowSize:null,direction:"vertical"},!0)),this.mainLayout.uiManager=this,this.mainLayout.scene=this.scene,this.scene.add(this.mainLayout)}get uiComponents(){return i(this,ee)}clean(){this.uiComponents.forEach(t=>{console.log("clean",this.scene),this.scene.remove(t)})}add(t){t instanceof F&&(t.uiManager=this,i(this,ee).unshift(t))}}ee=new WeakMap;class Hs extends Je{loop(t,e){this.entity.transform.rotation.setAngle(Math.sin(e/50)/10,!0)}}class As extends X{constructor(){super(...arguments);r(this,"shape");r(this,"style")}setup(){super.setup(),this.style=this.uiComponent.getComponent(g),this.shape=new be(this.uiComponent.transform.position,this.uiComponent.transform.size,this.style.borderRadius,this.style.color),this.shape=new Re("/button.png")}render(e){this.shape.position=this.uiComponent.transform.position,this.shape.size=this.uiComponent.transform.size,this.shape.color=this.style.color,this.shape.draw(e,this.uiComponent.transform)}}class $s extends F{setup(){super.setup(),this.addRenderer(new As)}}class ts extends X{constructor(){super(...arguments);r(this,"shape");r(this,"style")}setup(){super.setup(),this.style=this.uiComponent.getComponent(g),this.shape=new be(this.uiComponent.transform.position,this.uiComponent.transform.size,this.style.borderRadius,this.style.color)}render(e){this.shape.position=this.uiComponent.transform.position,this.shape.size=this.uiComponent.transform.size,this.shape.rotation=this.uiComponent.transform.rotation,this.shape.shadowBlur=this.style.shadowBlur,this.shape.shadowColor=this.style.shadowColor,this.shape.draw(e)}}class We extends F{setup(){super.setup(),this.addRenderer(new ts)}}class Vs extends F{setup(){super.setup();let t=this.getComponent(g);t||(t=new g,this.addComponent(t)),t.setStyle({color:new y(255,255,255,1),borderRadius:32},!0);let e=new We(new g({height:64,borderRadius:[32,32,0,0],color:new y(220,220,220)})),s=new We(new g({borderRadius:[8],margin:[32],color:new y(255,255,255,1),align:"center"}));this.addChild(e),this.addChild(s),this.setDefaultSlot(s),this.setSlot("header",e),this.addRenderer(new ts)}}class Ys extends X{constructor(){super(...arguments);r(this,"shape");r(this,"style")}setup(){super.setup(),this.style=this.uiComponent.getComponent(g),this.shape=new be(this.uiComponent.transform.position,this.uiComponent.transform.size,this.style.borderRadius,this.style.color)}render(e){this.shape.position=this.uiComponent.transform.position,this.shape.size=this.uiComponent.transform.size,this.shape.rotation=this.uiComponent.transform.rotation,this.shape.shadowBlur=this.style.shadowBlur,this.shape.shadowColor=this.style.shadowColor,console.log("render",this.style),this.shape.draw(e)}}class qs extends F{setup(){super.setup(),this.addRenderer(new Ys)}}class Xs extends X{constructor(){super(...arguments);r(this,"shape");r(this,"style")}setup(){super.setup(),this.style=this.uiComponent.getComponent(g),this.shape=new Ke(this.uiComponent.text,this.uiComponent.transform.position,this.style.color,this.style.fontSize),new FontFace("BraahOne","url(/BraahOne-Regular.ttf)").load().then(s=>{document.fonts.add(s)})}render(e){this.shape.position=this.uiComponent.transform.position,this.shape.size=this.uiComponent.transform.size,this.shape.position.x+=this.shape.size.x/2,this.shape.position.y+=this.shape.size.y/2,this.shape.draw(e)}}class Zs extends F{constructor(){super(...arguments);r(this,"text")}setup(){super.setup(),this.reactToEvents=!1;let e=this.getComponent(g);e||(e=new g,this.addComponent(e)),e.setStyle({height:"100%"},!0),this.addRenderer(new Xs)}setText(e){this.text=e}}const Ks={Application:Ie,Viewer:ms,Viewer2d:$e,CameraManager:Es,Component:ot,Observer:w,Project:Ms,Scene:Is,Engine:Ne,Entity:Te,EntityManager:Ce,Controls:Ze,RGB:y,Rotation:v,Vector2:c,CanvasRenderer:Ae,Renderer:He,commands:{Command:R,CommandClick:Pe,CommandHold:Ye,CommandMouseMove:qe,CommandOnce:De,CommandSwipe:Xe,CommandToggle:Le,CommandTouchMaintain:Se},components:{Render2DComponent:Ts,TransformComponent:se},shapes:{Circle:Ps,CircleScreen:Ds,DebugVector:Ls,Draw:T,Img:Re,Line:Os,MultiLine:Us,Path:Rs,RoundSquare:be,Sprite:Fs,SpriteSequence:Ws,Square:js,Text:Ke}},Js={Time:P,Timer:xe,NumericUtils:bs,ObjectUtils:Ns},Qs={ImplementError:S,UndefinedError:Ve,WrongInstanceError:Oe},Gs={core:{UIAnimation:Je,UIComponent:F,UIManager:Bs,UIRenderer:X,UIStyle:g,UIStyleHandler:Qe},events:{OnClick:Ge},animations:{ShakeAnimation:Hs},components:{Button:$s,Card:Vs,DebugDiv:qs,Div:We,Label:Zs,MainLayout:_e}};d.core=Ks,d.errors=Qs,d.ui=Gs,d.utils=Js,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
